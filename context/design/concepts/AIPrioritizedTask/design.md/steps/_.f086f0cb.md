---
timestamp: 'Thu Oct 23 2025 21:21:07 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251023_212107.519696ab.md]]'
content_id: f086f0cbc5bc5195e912053a3a5164c2457a22ff7c5026aafbb64ae6121b5d2b
---

# AIPrioritizedTask - Design Changes

## Design Change 1: Single Integrated Concept

**Decision**: Combined task management, AI estimation, and priority calculation in one concept instead of splitting into separate Task, Priority, and Assigner concepts from Assignment 2.

**Rationale**: Reuses existing work from intro-gemini-schedule, reduces coordination complexity, and AI prioritization is fundamentally tied to task attributes.

## Design Change 2: System Actions for Automated Updates

**Decision**: Include system actions (`markOverdue`, `calculateTaskPriority`) that run automatically without user interaction.

**Rationale**: Priority must update as time passes, and overdue status must be automatically set when due date is reached.

## Design Change 3: Priority Formula

**Decision**: `priorityScore = timeBasedScore + (importance × 50) + (difficulty × 30) + (1/effort × 100)`

**Rationale**: Previously, I used effort rather than 1/effort. But low effort, high stakes tasks should be prioritized first, so I inverted the effort score.

## Design Change 4: Snooze Resets Overdue Status

**Decision**: When task is snoozed, `overdue` flag is set to false.

**Rationale**: User explicitly deferred task, so overdue status no longer applies. Prevents confusing UX where snoozed tasks still show "overdue".

## Design Change 5: Clear AI Attributes on Completion

**Decision**: When task is completed, set all AI-inferred attributes to null and priority to 0.

**Rationale**: Completed tasks don't need prioritization, reduces storage overhead, prevents confusion if task is uncompleted later.

## Testing

**Test Coverage**: 19 separate Deno tests covering operational principle, all 6 actions, 3 queries, and edge cases.

**Tests Included**:

* 1 operational principle test (create → update → mark overdue → query → complete)
* 4 createTask tests (valid, duplicate name, empty name, invalid date)
* 3 updateTask tests (valid update, duplicate name, empty name)
* 3 snoozeTask tests (valid snooze, past date, current time)
* 1 completeTask test (verify priority=0, AI attributes cleared)
* 3 markOverdue tests (mark overdue, skip if completed, skip if not due)
* 2 calculateTaskPriority tests (recalculate, skip if completed)
* 3 query tests (getTask, getTasksByOwner, getPrioritizedTasks with sorting)

**Adjustments Made**:

* Fixed `markOverdue` test: Changed assertion from "priority must increase" to "overdue flag set and priority non-zero" (priority already high for past dates before marking overdue)
* Fixed `calculateTaskPriority` test: Compare `lastPriorityCalculationTime` instead of priority value (LLM might return same values)
* Fixed query tests: Use unique test users to avoid conflicts from shared test database state
